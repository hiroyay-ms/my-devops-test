FROM ubuntu:20.04

ARG RUNNER_VERSION="2.298.2"
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update -y && \ 
    apt-get install -y curl wget expect jq && \
    apt-get upgrade -y && \ 
    useradd -m runner

RUN wget https://packages.microsoft.com/config/ubuntu/20.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb && \ 
    dpkg -i packages-microsoft-prod.deb && \ 
    rm packages-microsoft-prod.deb

RUN cd /home/runner && \ 
    mkdir actions-runner && \ 
    cd actions-runner && \
    curl -o actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz -L https://github.com/actions/runner/releases/download/v${RUNNER_VERSION}/actions-runner-linux-x64-${RUNNER_VERSION}.tar.gz && \ 
    tar xzf ./actions-runner-linux-x64-2.298.2.tar.gz

RUN chown -R runner ~runner && \ 
    /home/runner/actions-runner/bin/installdependencies.sh

COPY start.sh start.sh

RUN chmod +x start.sh

USER runner

ENTRYPOINT [ "./start.sh" ]